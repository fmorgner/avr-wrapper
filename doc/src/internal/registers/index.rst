********************************************
AVR Special Function Register Infrastructure
********************************************

This chapter introduces the **AVR Special Function Register API**. This API
provides access to the Special Function Registers of an AVR microcontroller.
These registers can be used for controlling various interfaces of an AVR
controller.


Usage Example
=============

The following code blocks demonstrates how to use the types described in this
chapter to access a Special Function Register on an AVR microcontroller::
 
  #include "avr/internal/registers.hpp"

  struct mega328p {
    ~mega328p() = delete;

    using pinb = registers::pin_register<0x23, 0b11111111>;
    using ddrb = registers::ddr_register<0x24, 0b11111111>;
    using portb = registers::port_register<0x25, 0b11111111>;

    using pinc = registers::pin_register<0x26, 0b01111111>;
    using ddrc = registers::ddr_register<0x27, 0b01111111>;
    using portc = registers::port_register<0x28, 0b01111111>;

    using pind = registers::pin_register<0x29, 0b11111111>;
    using ddrd = registers::ddr_register<0x2a, 0b11111111>;
    using portd = registers::port_register<0x2b, 0b11111111>;
  };

  int main() {
    if(mega328p::portb::port<3>::get()) {
      mega328p::portb::port<7>::set();
    } else {
      mega328p::portb::port<7>::clear();
    }
  }

The machine code generated by the above C++ code demonstrates that there is no
overhead incurred by the wrappers. At the same time, all accesses to bits and
registers are checked at compile time

.. code-block:: objdump

  00000080 <main>:
    80:	1b 9b       	sbis	0x03, 3	; 3
    82:	04 c0       	rjmp	.+8      	; 0x8c <main+0xc>
    84:	1f 9a       	sbi	0x03, 7	; 3
    86:	90 e0       	ldi	r25, 0x00	; 0
    88:	80 e0       	ldi	r24, 0x00	; 0
    8a:	08 95       	ret
    8c:	1f 98       	cbi	0x03, 7	; 3
    8e:	fb cf       	rjmp	.-10     	; 0x86 <main+0x6>

Base Type
=========

.. doxygenclass:: avr::internal::registers::special_function_register

Full Register Access
--------------------

.. doxygenfunction:: avr::internal::registers::special_function_register::get

.. doxygenfunction:: avr::internal::registers::rw_special_function_register::set

Bitwise Register Access
-----------------------

.. doxygentypedef:: avr::internal::registers::rw_special_function_register::bit
.. doxygentypedef:: avr::internal::registers::ro_special_function_register::bit

.. doxygenstruct:: avr::internal::registers::bit
  :members:

.. doxygenstruct:: avr::internal::registers::rw_bit
  :members:

Specialized Types and Aliases
=============================

.. doxygenstruct:: avr::internal::registers::pin_register
.. doxygenstruct:: avr::internal::registers::ddr_register
.. doxygenstruct:: avr::internal::registers::port_register
